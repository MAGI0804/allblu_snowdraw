# 幼岚童装 Go 后端项目

**更新日期：2025-12-25**

这是一个基于 Go 语言的现代化后端项目，通过 Gin 框架、GORM 数据库映射和 JWT 认证机制构建，为幼岚童装业务提供稳定可靠的 API 服务。


## 项目结构

```
django_to_go/
├── config/                    # 配置相关
│   └── config.go              # 配置文件
├── controllers/               # 控制器
│   ├── access_token_controller.go      # 访问令牌控制器
│   ├── activity_controller.go           # 活动控制器
│   ├── address_controller.go            # 地址控制器
│   ├── cart_controller.go               # 购物车控制器
│   ├── commodity_controller.go          # 商品控制器
│   ├── operationuser_controller.go      # 运营用户控制器
│   ├── order_controller.go              # 订单控制器
│   ├── snow_function_controller.go      # 抽奖功能控制器
│   ├── snow_lottery_draw_controller.go  # 抽奖活动控制器
│   ├── snow_order_data_controller.go    # 抽奖订单数据控制器
│   ├── snow_success_user_controller.go  # 抽奖成功用户控制器
│   ├── snow_user_controller.go          # 抽奖用户控制器
│   └── user_controller.go               # 用户控制器
├── db/                        # 数据库相关
│   ├── db.go                  # 数据库连接
│   └── migrations.go          # 数据库同步
├── middleware/                # 中间件
│   └── auth_middleware.go     # 认证中间件
├── models/                    # 数据模型
│   ├── user.go                # 用户模型
│   ├── commodity.go           # 商品模型
│   ├── order.go               # 订单模型
│   ├── address.go             # 地址模型
│   └── cart.go                # 购物车模型
├── routes/                    # 路由配置
│   ├── routes.go                       # 主路由注册
│   ├── activity_routes.go              # 活动路由
│   ├── address_routes.go               # 地址路由
│   ├── cart_routes.go                  # 购物车路由
│   ├── commodity_routes.go             # 商品路由
│   ├── operationuser_routes.go         # 运营用户路由
│   ├── order_routes.go                 # 订单路由
│   ├── return_order_routes.go          # 退货订单路由
│   ├── snow_function_routes.go         # 抽奖功能路由
│   ├── snow_lottery_draw_routes.go     # 抽奖活动路由
│   ├── snow_order_data_routes.go       # 抽奖订单数据路由
│   ├── snow_success_user_routes.go     # 抽奖成功用户路由
│   └── snow_user_routes.go             # 抽奖用户路由
├── utils/                     # 工具函数
│   └── utils.go               # 通用工具函数
├── main.go                    # 项目入口
├── go.mod                     # Go模块定义
└── README.md                  # 项目说明
```

## 核心依赖项

项目基于 Go 1.24.0 开发，主要依赖包括：

- **Gin** (v1.10.1): 高性能 Web 框架
- **GORM** (v1.25.5): 强大的 ORM 库，搭配 MySQL 驱动 (v1.5.2)
- **JWT** (v4.5.2): JSON Web Token 认证机制
- **Excelize** (v2.9.1): Excel 文件处理库
- **阿里云短信服务**: 用于短信验证码发送
- **加密库**: 提供安全的加密算法支持

## 配置说明

配置信息集中管理在 `config/config.go` 文件中，支持通过环境变量覆盖默认值，提高部署灵活性。

### 核心配置结构

1. **数据库配置**
   - 数据库驱动、主机、端口、用户名、密码、数据库名和字符集

2. **JWT认证配置**
   - 密钥、访问令牌过期时间（60分钟）、刷新令牌过期时间（24小时）

3. **微信小程序配置**
   - 小程序AppID、AppSecret和登录API地址

### 环境变量覆盖

所有配置项均可通过环境变量进行覆盖，如数据库连接信息、JWT密钥等。

## 如何运行

### 环境要求
- Go 1.24.0 或更高版本
- MySQL 数据库服务

### 运行步骤

1. **安装依赖**
   ```bash
   go mod tidy
   ```

2. **配置数据库**
   确保 MySQL 数据库已正确配置，并可通过配置文件或环境变量访问。

3. **启动服务**
   ```bash
   go run main.go
   ```

默认情况下，服务将在 `http://localhost:8080` 启动。

## 主要功能

### 1. 用户管理
- **用户注册**：支持手机号注册，包含手机号格式验证和密码加密存储
- **用户信息查询**：根据用户ID查询详细信息
- **用户信息修改**：支持更新用户基本信息
- **获取用户ID**：获取当前用户ID
- **微信小程序登录**：集成微信授权登录功能
- **登录状态验证**：基于JWT的身份认证机制

### 2. 地址管理
- **添加地址**：新增用户收货地址
- **删除地址**：删除用户收货地址
- **更新地址**：修改用户收货地址
- **设置默认地址**：设置默认收货地址
- **获取地址列表**：查询用户所有收货地址
- **根据ID获取地址**：根据地址ID查询详细信息

### 3. 商品管理
- **获取所有分类**：查询商品所有分类信息
- **搜索款号**：根据关键词搜索商品款号
- **添加商品**：创建新商品信息
- **删除商品**：删除指定商品
- **搜索商品数据**：多条件搜索商品信息
- **商品查询**：根据条件查询商品详情
- **修改商品数据**：更新商品信息
- **商品上架/下架**：管理商品上架和下架状态
- **获取商品状态**：查询商品当前状态
- **按名称搜索商品**：根据商品名称搜索
- **批量获取商品**：根据ID列表批量查询商品
- **款号状态管理**：管理商品款号的上架和下架状态
- **获取款号商品**：根据款号查询相关商品
- **更新款号信息**：修改商品款号信息

### 4. 订单管理
- **创建订单**：提交新订单
- **查询订单详情**：根据订单ID查询详细信息
- **修改收货信息**：更新订单收货地址
- **修改订单状态**：更新订单状态
- **查询订单列表**：支持按用户ID、状态等条件查询订单列表
- **批量查询订单**：批量获取订单信息
- **更新物流信息**：录入订单物流信息
- **同步物流信息**：同步外部物流数据
- **更新订单**：修改订单信息
- **取消订单**：取消未支付订单
- **支付订单**：处理订单支付
- **发货**：标记订单为已发货
- **根据用户ID查询订单**：获取指定用户的所有订单
- **申请退换货**：处理订单退换货申请
- **确认收货**：用户确认收到商品

### 5. 抽奖活动管理
- **创建抽奖活动**：新增抽奖活动信息
- **修改抽奖活动**：更新抽奖活动详情
- **获取中奖名单**：查询指定抽奖活动的中奖用户
- **查询抽奖活动**：获取所有或单个抽奖活动信息
- **添加中奖名单**：手动添加中奖用户信息
- **获取所有中奖名单**：支持按抽奖轮次筛选中奖记录
- **根据用户ID获取中奖名单**：查询指定用户的中奖历史
- **查询抽奖活动详情**：获取包含抽奖波次、开奖时间、开奖情况、前5个抽奖码的完整信息

### 6. 其他功能
- **数据导入导出**：支持Excel格式的数据处理
- **短信验证码**：集成阿里云短信服务
- **安全认证**：基于JWT的访问控制和权限验证
- **活动管理**：提供活动相关功能接口
- **购物车管理**：购物车商品的添加、删除、更新等
- **运营用户管理**：运营人员相关功能
- **退货订单管理**：处理退货业务

## API 路由

API 路由配置在 `routes/routes.go` 文件中，采用模块化设计，主要包括以下几类路由：

### 1. JWT 认证路由
- `POST /api/token/obtain/`: 获取访问令牌
- `POST /api/token/refresh/`: 刷新访问令牌

### 2. 核心业务路由
- **商品管理**: 商品列表、详情、创建、更新、删除等
- **用户管理**: 用户注册、信息查询、地址管理等
- **订单管理**: 订单查询、创建、状态更新等
- **购物车管理**: 购物车商品的添加、删除、更新等
- **活动管理**: 活动相关功能接口

### 3. 系统路由
- `GET /api/test/`: 测试接口
- `GET /api/health/`: 健康检查接口

### 4. 其他路由
- **运营用户管理**: 运营人员相关功能
- **退货订单管理**: 处理退货业务
- **抽奖活动管理**: 抽奖功能相关接口

所有路由设计完全匹配原 Django 版本，确保 API 兼容性。

## 注意事项

- 项目使用 GORM 作为 ORM 库，支持数据库迁移
- 所有 API 响应都采用统一的 JSON 格式
- 认证使用 JWT 令牌机制
- 支持跨域请求
- 提供了静态文件服务

## 开发建议

### 1. 代码组织与结构
- **模型优先**：添加新功能时，先定义数据模型（models），再创建控制器（controllers）和路由（routes）
- **模块化设计**：遵循现有的模块划分，保持代码结构清晰
- **单一职责原则**：每个函数和方法只负责一项功能

### 2. 安全与性能
- **权限验证**：使用中间件进行统一的权限验证
- **数据安全**：敏感数据（如密码）必须加密存储
- **性能优化**：合理使用缓存，避免不必要的数据库查询
- **错误处理**：添加适当的错误处理和日志记录，确保系统稳定性

### 3. 编码规范
- **代码风格**：保持与现有代码一致的风格，使用Go标准格式化
- **命名规范**：使用有意义的变量和函数名，遵循驼峰命名法
- **注释**：为复杂逻辑添加清晰的注释，提高代码可读性

### 4. 测试与质量
- **单元测试**：为关键功能编写单元测试
- **代码审查**：定期进行代码审查，确保代码质量
- **文档更新**：及时更新API文档和README，保持文档与代码一致性

### 5. API兼容性
- 遵循现有的API设计模式，确保与前端和其他系统的兼容性
- 接口变更时，考虑向后兼容或提供迁移方案

## 部署说明

### 本地开发环境

1. **环境准备**
   - 安装Go 1.24.0或更高版本
   - 确保MySQL数据库已配置并运行

2. **启动方式**
   - 使用启动脚本（如果存在）：`./run.sh`
   - 手动执行：
     ```bash
     # 安装依赖
     go mod tidy
     
     # 构建项目
     go build -o youlan_kids_go main.go
     
     # 运行应用
     ./youlan_kids_go
     ```

### Docker部署

1. **环境准备**
   - 确保已安装Docker和docker-compose

2. **部署步骤**
   - 在项目根目录运行：
     ```bash
     docker-compose up --build -d
     ```
   - 应用将在8080端口启动

### 环境变量配置

应用支持通过环境变量覆盖默认配置，主要环境变量包括：

#### 数据库配置
- `DB_HOST`: 数据库主机地址
- `DB_PORT`: 数据库端口
- `DB_NAME`: 数据库名称
- `DB_USER`: 数据库用户名
- `DB_PASSWORD`: 数据库密码

#### JWT配置
- `SECRET_KEY`: JWT密钥
- `JWT_ACCESS_TOKEN_LIFETIME`: JWT访问令牌有效期（分钟）
- `JWT_REFRESH_TOKEN_LIFETIME`: JWT刷新令牌有效期（分钟）

#### 其他配置
- `DB_ENGINE`: 数据库驱动（默认：mysql）

## License

本项目使用 MIT 许可证。
